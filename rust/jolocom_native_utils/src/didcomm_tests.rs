use super::{
    error::Error,
    wallet::{
    create_didcomm_message,
    create_jwe_didcomm_message,
    seal_didcomm_message,
    receive_didcomm_message,
    }
};

const ALICE_WALLET_WITH_DIDKEY: [u8; 658] = [210,221,182,151,234,164,26,160,239,139,71,39,34,229,55,228,165,130,129,135,109,246,155,199,213,173,168,122,195,236,61,214,221,95,53,120,87,34,194,119,241,245,87,224,234,181,255,232,180,99,173,9,158,64,8,126,180,43,135,130,17,105,240,234,163,17,80,195,106,214,69,108,159,32,180,169,70,197,236,106,81,139,246,66,141,77,238,47,83,77,222,51,28,134,192,178,6,181,29,14,85,54,171,53,80,90,243,202,240,254,46,32,60,63,190,192,132,142,121,25,204,30,53,153,58,201,144,57,211,15,140,28,71,56,216,56,211,190,46,222,182,123,205,43,21,143,2,234,157,50,219,96,176,97,247,17,222,246,7,200,78,65,96,215,47,173,170,204,134,237,7,25,65,71,125,219,105,177,21,85,71,148,54,102,160,53,180,102,146,0,148,96,188,231,153,150,224,97,197,1,129,81,159,109,207,208,34,90,212,101,141,39,191,20,164,109,7,91,3,7,56,116,33,198,109,205,5,240,103,200,32,75,60,164,137,105,179,184,116,188,15,38,216,109,98,150,118,43,12,182,165,105,118,193,233,206,191,207,83,124,68,76,16,251,52,119,89,33,163,60,124,214,192,228,37,42,244,183,1,131,4,200,188,142,110,118,94,204,175,159,128,197,125,208,29,64,166,220,3,137,85,66,149,252,221,220,100,122,26,87,4,55,2,32,134,79,253,134,200,129,127,219,64,180,157,142,5,35,119,21,238,184,109,20,118,197,12,195,119,172,47,154,52,54,186,229,142,176,73,206,148,151,224,237,226,81,189,187,85,215,84,127,178,253,26,205,204,137,217,27,180,18,181,72,234,144,147,238,220,37,3,100,45,127,31,187,233,53,7,183,172,194,228,254,51,170,107,138,46,121,136,86,213,147,78,168,46,50,64,237,39,242,87,117,194,188,118,65,133,243,202,221,31,166,65,90,114,205,28,27,221,171,123,94,246,169,106,230,36,251,183,58,246,223,16,54,170,184,152,21,246,79,125,159,155,170,202,28,161,72,137,11,135,59,176,90,46,15,127,47,118,64,180,233,173,68,102,59,26,84,85,220,254,17,63,101,165,23,155,144,84,217,248,146,130,195,70,138,17,218,24,9,182,0,211,69,100,63,126,63,160,153,90,108,50,5,250,34,254,73,4,166,146,7,81,183,111,123,42,78,131,51,145,149,234,164,98,78,177,127,187,143,81,238,205,232,249,61,71,177,125,147,37,150,94,173,137,140,68,12,141,156,32,64,99,74,208,209,217,252,89,207,43,196,213,97,39,181,157,231,178,213,0,111,127,219,150,140,170,48,164,239,203,35,246,106,139,76,29,154,103,224,187,222,21,220,189,36,101,195,146,176,119,93,17,190,165,89,96,33,99,169,207,191,88,104,229,115,149,251,225,160,241,31,93,10,79,176,88,245,23,216,186,148,122,225,200,75,95,206,140,240,144,227,239,58,58,39];
const BOB_WALLET_WITH_DIDKEY: [u8; 656] = [140,74,180,253,132,37,63,68,76,122,205,61,77,50,14,135,216,46,197,190,202,152,219,158,69,90,157,51,66,82,42,220,134,121,123,183,205,115,201,118,222,233,115,182,255,92,242,222,18,237,193,128,232,36,168,69,49,251,168,18,235,182,50,122,111,163,86,92,52,62,145,73,246,140,101,18,119,6,149,134,27,129,156,154,93,241,30,233,46,115,187,16,23,5,130,165,119,95,143,64,133,134,217,94,89,21,233,168,29,84,54,12,14,229,82,115,80,150,94,37,252,172,109,195,220,27,107,121,68,77,214,60,228,217,193,234,190,61,190,12,220,138,4,165,62,24,214,245,243,94,205,210,129,165,73,148,69,37,41,64,26,137,109,231,111,84,36,240,215,157,97,137,19,213,165,178,245,231,189,162,243,151,49,61,23,98,80,116,105,195,212,245,182,193,33,40,230,204,245,216,4,4,239,168,241,135,207,97,88,115,79,64,22,237,198,60,93,171,193,90,128,46,153,157,119,99,31,140,209,18,243,14,131,39,176,130,45,16,155,140,142,216,237,232,183,211,184,139,121,98,237,33,30,238,10,204,149,158,45,6,244,83,98,155,167,186,107,254,127,96,235,77,94,26,170,43,159,154,219,36,239,83,174,17,191,43,47,216,204,156,229,207,250,223,87,94,55,40,167,229,253,93,30,179,6,40,55,246,247,237,104,170,21,127,26,68,93,200,62,130,127,38,111,23,166,193,146,128,226,154,125,119,22,108,44,0,178,6,83,58,101,227,78,119,172,90,46,151,111,144,42,155,87,67,105,191,48,1,55,104,104,75,147,226,112,80,159,141,54,176,218,137,251,64,155,195,215,202,216,122,7,241,40,191,222,168,19,83,218,157,85,1,127,67,153,43,132,84,106,249,38,140,212,145,160,120,92,1,248,83,254,157,13,50,34,144,236,21,127,185,68,103,207,178,188,190,50,227,159,35,12,138,133,148,41,79,75,162,4,234,104,147,84,170,94,34,75,186,245,192,17,187,237,73,93,232,1,231,93,92,218,182,127,162,165,230,42,67,72,119,41,71,65,170,1,67,136,140,98,25,50,196,226,65,202,150,167,11,3,121,211,126,90,246,208,97,182,119,167,191,31,158,162,50,153,244,38,230,57,158,113,219,198,212,197,87,255,104,91,80,240,61,149,76,196,216,125,178,222,139,46,160,190,110,255,56,181,193,248,215,53,134,132,22,254,219,150,41,140,222,101,43,223,244,15,138,69,48,130,80,51,113,101,254,160,5,79,62,112,113,189,20,4,106,116,22,110,246,175,96,96,237,166,57,63,0,205,191,125,202,44,135,88,249,189,171,214,196,245,71,174,241,67,55,241,30,122,209,67,218,227,190,42,155,103,160,174,22,42,254,79,166,24,146,238,92,60,24,233,165,60,85,164,1,223,22,6,238,212,246,44,65,201,57,147,89,117,115,30,201,5,188,117,61,85,47];

#[test]
fn create_didcomm_message_test() {
    // Arrange + Act
    let m = create_didcomm_message();

    // Assert
    assert!(m.len() > 0);
}

#[test]
fn seal_didcomm_message_test() -> Result<(), Error> {
    // Arrange
    let m = create_jwe_didcomm_message(
        "did:key:z6MkiTBz1ymuepAQ4HEHYSF1H8quG5GLVVQR3djdX3mDooWp",
        &["did:key:z6MkjchhfUsD6mmvni8mCdXHw216Xrm9bQe2mBH1P5RDjVJG"],
        &"ECDH-ES+A256KW".into()
        ).unwrap();
    // Act
    let encoded_alice = base64::encode_config(ALICE_WALLET_WITH_DIDKEY, base64::URL_SAFE);
    let sealed  = seal_didcomm_message(
        &encoded_alice,
        "alice", 
        "alice", 
        &m);
    // Assert
    assert!(sealed.is_ok());

    Ok(())
}

#[test]
fn seal_signed_didcomm_message_test() {

}

#[test]
fn receive_didcomm_message_test() {
    let m = create_didcomm_message();
    let mut m: didcomm_rs::Message = serde_json::from_str(&m).unwrap();
    m = m.as_jwe(&didcomm_rs::crypto::CryptoAlgorithm::XC20P)
        .to(&["did:key:z6MkjchhfUsD6mmvni8mCdXHw216Xrm9bQe2mBH1P5RDjVJG"])
        .from("did:key:z6MkiTBz1ymuepAQ4HEHYSF1H8quG5GLVVQR3djdX3mDooWp");
    let sealed  = seal_didcomm_message(
        &base64::encode_config(ALICE_WALLET_WITH_DIDKEY, base64::URL_SAFE), 
        "alice", 
        "alice",  
        &serde_json::to_string(&m).unwrap()).unwrap();
    let encoded_bob = base64::encode_config(BOB_WALLET_WITH_DIDKEY, base64::URL_SAFE);
    let received = receive_didcomm_message(
        &encoded_bob,
        "bob",
        "bob",
        &sealed.as_bytes());
    match &received {
        Ok(_) => assert!(true),
        Err(e) => println!("{:?}", e)
    }
    assert!(received.is_ok());
}

